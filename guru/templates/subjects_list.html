{% extends 'base.html' %}
{% load static %}
{% block title %} Home view {% endblock %}
{% load crispy_forms_tags %}
{% block content %}
<div>	
	{% include 'navigation.html' %}
    {% if form %}
        <div class="messages mt-4 container">
    	    <center> 
				<button onclick="on(document.getElementsByClassName('overlay')[0])" id="add-subject-btn"> 
					Add a subject
				</button>
			<center><br>

            {% for message in messages %}
                <div class='alert alert-{{ message.tags }} alert-dismissible fade show'>
                    {{ message }} 
                      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

	<div class="container-fluid">
		{% if form %}
		<div class="overlay">
			<form style="width:300px;"class="overlayform" action="/guru/{{classroom.unique_id}}/" 
				method="POST" enctype="multipart/form-data">
				<a onclick="off(document.getElementsByClassName('overlay')[0])" id="close"> &times;</a><br><br>
				{% csrf_token %}
				<input type="text" name="subject_name" placeholder="Add a subject."
						maxlength="50" required id="id_subject_name"><br>
				<input type="text" name="teacher" placeholder="username of teacher."><br>
				<center>
					<input type="submit" class="btn btn-success text-white" value="Add">
				</center>
			</form>
		</div>
		{% endif %}

		{% if subjects %}
		<div class="row">
			{% for subject in subjects %}
			<div class="col-xs-12 col-md-6 col-lg-4">
				<a class="text-center" style="color:white;"
					href="{% url 'resources' classroom.unique_id subject.id  %}">
				<div class="subject-container">
				  <img src="{{subject.subject_pic.url }}" alt="Notebook" style="width:100%;height:350px;">
				  <div class="content">
					    <h1>{{ subject|upper }}</h1>
					    <p>by {{subject.teacher }}</p>
				  </div>
				</div>
				</a>
			</div>
			{% endfor %}
		</div>
		{% else %}
			{% if is_teacher  %}
				<h1 class="text-center text-danger"> 
					No subject is added yet. Kindly add a subject so your students can study. 
				</h1>
			{% else %}
				<h1 class="text-center text-danger"> 
					No subject is added yet. Kindly ask your admin to add a subject. 
				</h1>
			{% endif %}
		{% endif %}

		<div v-if="members">

			{% if is_teacher %}
				{% if pending_members %}
					<center><h1 style="color:green">Pending members</h1></center>
				{% endif %}
				{% for member in pending_members %}
					<div class="row">
						<div class="member-card">
							<div class="wrapper"><br/>
								<div class="opts">
									<div class="dropdown">
										<div class="dropbtn">...</div>
										<div class="dropdown-content">
											<a href="{% url 'delete_request' classroom.unique_id member.username %}">
												Delete request
											</a>
											<a href="{% url 'accept_request' classroom.unique_id member.username %}">
												Accept request
											</a>
										</div>
									</div>
								</div>
								<img src="{{member.profile.profile_pic.url}}">
								<div class="member-container">
									<h4><b>{{ member.username }} &nbsp; &nbsp;</b></h4>
									<p>{{member.profile.bio}}</p>
								</div>

							</div>
						</div>
					</div>
				{% endfor %} 
			{% endif %}

			{% for teacher in teachers %}
			<div class="row">
				<div class="member-card">
					<div class="wrapper"><br/>
						{% if is_teacher %}
						<div class="opts">
							<div class="dropdown">
								<div class="dropbtn">...</div>
								<div class="dropdown-content">
									<a href="{% url 'remove_member' classroom.unique_id teacher.username %}">
										Remove from classroom
									</a>
									<a href="{% url 'remove_admin' classroom.unique_id teacher.username %}">
										Remove from teacher position
									</a>
								</div>
							</div>
						</div>
						{% endif %}
					</div>
					<img src="{{teacher.profile.profile_pic.url}}">
					<div class="member-container">
						<h4><b>{{ teacher.username }} &nbsp; &nbsp; <span style="float:right;color:green;">Teacher</span></b></h4>
						<p style="word-wrap: wrap;">{{teacher.profile.bio}}</p>
					</div>
				</div>
			</div>
			{% endfor %}

			{% for student in students %}
			<div class="row">
				<div class="member-card">
					<div class="wrapper"><br/>
						<div class="opts">
							<div class="dropdown">
								<div class="dropbtn">...</div>
								<div class="dropdown-content">
									{% if is_teacher %}
									<a href="{% url 'remove_member' classroom.unique_id student.username %}">
										Remove from classroom
									</a>
									<a href="{% url 'make_admin' classroom.unique_id student.username %}">
										Make Teacher
									</a>
									{% else %}
										{% if user.username == student.username %}
											<a href="{% url 'remove_member' classroom.unique_id user.username %}">
											 Leave classroom
											</a>
										{% endif %}
									{% endif %}
								</div>
							</div>
						</div>
					</div>
					<img src="{{student.profile.profile_pic.url}}">
					<div class="member-container">
						<h4><b>{{ student.username }} &nbsp; &nbsp;</b></h4>
						<p>{{student.profile.bio}}</p>
					</div>
				</div>
			</div>
			{% endfor %}
		</div>
	</div>
	<!-- Subjects end  -->
</div>
{% endblock %}