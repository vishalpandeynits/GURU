{% extends 'base.html' %}
{% load socialaccount %}
{% block title %} {{ p_user.first_name|upper}} {% endblock %}
{% load filters %}
{% load static %}
{% load account %}
{% load humanize %}
{% block css %}
<style>
.profile-header {
  background: #fff;
  display: flex;
  position: relative;
  box-shadow: 0px 3px 4px rgba(0, 0, 0, 0.2);
}
.profile-img {
  float: left;
  width: 340px;
  height: 200px;
}

.profile-img img {
  border-radius: 50%;
  height: 230px;
  width: 230px;
  border: 5px solid #fff;
  box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.2);
  position: absolute;
  left: 50px;
  top: 20px;
  z-index: 5;
  background: #fff;
}

.profile-nav-info {
  float: left;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding-top: 60px;
  background:white;
}

.profile-nav-info h3 {
  font-variant: small-caps;
  font-size: 2rem;
  font-family: sans-serif;
  font-weight: bold;
}

.profile-nav-info .address {
  display: block;
  margin:5px;
  font-weight: bold;
  color: #777;
}

.profile-nav-info .address p {
  margin-right: 5px;
}

.profile-option {
  width: 40px;
  height: 40px;
  position: absolute;
  right: 50px;
  top: 50%;
  transform: translateY(-50%);
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: all 0.5s ease-in-out;
  outline: none;
  background: #e40046;
}

.profile-option:hover {
  background: #fff;
  border: 1px solid #e40046;
}
.profile-option:hover .notification i {
  color: #e40046;
}

.profile-option:hover span {
  background: #e40046;
}

.profile-option .notification i {
  color: #fff;
  font-size: 1.2rem;
  transition: all 0.5s ease-in-out;
}

.profile-option .notification .alert-message {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #fff;
  color: #e40046;
  border: 1px solid #e40046;
  padding: 5px;
  border-radius: 50%;
  height: 20px;
  width: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 0.8rem;
  font-weight: bold;
}

.main-bd {
  width: 100%;
  display: flex;
  padding-right: 15px;
}

.profile-side {
  width: 300px;
  background: #fff;
  box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.2);
  padding: 90px 30px 20px;
  font-family: "Bree Serif", serif;
  margin-left: 10px;
}

.profile-side p {
  margin-bottom: 7px;
  color: #333;
  font-size: 14px;
}

.profile-side p i {
  color: #e40046;
  margin-right: 10px;
}

.mobile-no i {
  transform: rotateY(180deg);
  color: #e40046;
}

.profile-btn {
  display: flex;
}
.nav {
  width: 100%;
  z-index: -1;
}

.nav ul {
  display: flex;
  justify-content: flex-start;
  width:100%;
  flex-wrap: wrap;
  list-style-type: none;
  background: #fff;
  box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.3);
}

.nav ul li {
  padding: 10px;
  border: 5px solid rgb(224, 55, 84);
  cursor: pointer;
  text-align: center;
  transition: all 0.2s ease-in-out;
}

.nav ul li:hover,
.nav ul li.active {
  box-shadow: 0px -3px 0px rgba(288, 0, 70, 0.9) inset;
}

.profile-body {
  min-width: 52vw;
  width:100%;
  height:fit-content;
  min-height:60vh;
  background:white;
  position:relative;
  top:-20px;
}

.tab {
  display: none;
}

.tab {
  padding: 20px;
  width: 100%;
  text-align: center;
}
form{
    width:90%;
    display:block;
    margin:auto;
}
form input[type="text"]{
    width:100%;
    display:block;
}
form *{
    text-align: left !important;
}
@media screen and (max-width: 1100px) {
  .profile-side {
    width: 250px;
    padding: 90px 15px 20px;
  }

  .profile-img img {
    height: 200px;
    width: 200px;
    left: 50px;
    top: 50px;
  }
  ul li{
      display:block;
  }
}

@media (max-width: 900px) {
  body {
    margin: 0 20px;
  }

  .profile-header {
    display: flex;
    height: 100%;
    flex-direction: column;
    text-align: center;
    padding-bottom: 20px;
  }

  .profile-img {
    float: left;
    width: 100%;
    height: 200px;
  }

  .profile-img img {
    position: relative;
    height: 200px;
    width: 200px;
    left: 0px;
  }

  .profile-nav-info {
    text-align: center;
  }

  .profile-option {
    right: 20px;
    top: 75%;
    transform: translateY(50%);
  }

  .main-bd {
    flex-direction: column;
    padding-right: 0;
  }

  .profile-side {
    width: 100%;
    text-align: center;
    padding: 20px;
    margin: 5px 0;
  }

  .profile-nav-info .address {
    justify-content: center;
  }
}

@media (max-width: 400px) {
  .profile-option {
    width: 30px;
    height: 30px;
    position: absolute;
    right: 15px;
    top: 83%;
  }

  .profile-option .notification .alert-message {
    top: -3px;
    right: -4px;
    padding: 4px;
    height: 15px;
    width: 15px;
    font-size: 0.7rem;
  }

  .profile-nav-info h3 {
    font-size: 1.9rem;
  }

  .profile-nav-info .address p,
  .profile-nav-info .address span {
    font-size: 0.7rem;
  }
}
#see-more-bio,
#see-less-bio {
  color: blue;
  cursor: pointer;
  text-transform: lowercase;
}
.tab h1 {
  font-family: "Bree Serif", sans-serif;
  display: flex;
  justify-content: center;
  margin: 20px auto;
}
</style>
{% endblock %}
{% block content %}
<div>
	{% include 'snippets/navigation.html' %}
    {% if messages %}
        <div class="messages container">
			{% for message in messages %}
			<div class='alert alert-{{ message.tags }} border border-{{ message.tags }} alert-dismissible fade show'>
				{{ message }} 
				  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				  </button>
			</div>
		{% endfor %}
        </div>
	{% endif %}<br>
    <div class="container">
        <div class="profile-header">
          <div class="profile-img">
            <img 
            {% if accounts %} 
                {% if p_user.profile.profile_pic|filebasename != 'avatar.jpg' %}
                    src="{{ user.profile.profile_pic.url }}"
                {% else %}
                    src="{{ user.socialaccount_set.all.0.get_avatar_url }}"
                {% endif %}
            {% else %}
                src="{{ user.profile.profile_pic.url }}"
            {% endif %}
         width="200" alt="Profile Image">
          </div>
          <div class="profile-nav-info">
            <h3 class="user-name">{{p_user.first_name}} {{p_user.last_name}} Vishal Pandey</h3>
            <div class="address">
              <p id="state" class="state">{{p_user.username}}</p>
              <p id="state" class="state">Joined on {{p_user.date_joined|date }} </p>
            </div>
          </div>
          <div class="profile-option">
            <div class="notification">
              <i class="fa fa-bell"></i>
              <span class="alert-message">3</span>
            </div>
          </div>
        </div>
      
        <div class="main-bd">
          <div class="left-side">
            <div class="profile-side">
              <p class="mobile-no"><i class="fa fa-2x mb-2 fa-phone"></i> {{p_user.profile.phone_num }}</p>
              <p class="user-mail"><i class="fa fa-2x mb-2 fa-envelope"></i> {{p_user.profile.email }}</p>
              <p class="mobile-no"><i class="fab fa-2x fa-whatsapp"></i></i> {{p_user.profile.phone_num }}</p>
              <div class="user-bio">
                <h3>Bio</h3>
                <p class="bio">
                    {{p_user.phone_num }}
                </p>
              </div>
            </div>
      
          </div>
          <div class="right-side">
            <div class="nav">
              <ul>
                <li onclick="tabs(0)" class="user-post active">Classrooms</li>
                <li onclick="tabs(1)" class="user-review">Update Profile</li>
                <li onclick="tabs(2)" class="user-setting"> Pending requests </li>
              </ul>
            </div>

            <div class="profile-body">
              <div class="profile-posts tab">
                <h1>Classrooms</h1>
                {% for class in classes %}
                <div class="alert alert-primary">
                    <a href="{% url 'subjects' class.unique_id %}">{{class.class_name}}</a>
                </div>
                {% empty %}
                    <strong> You have not joined or created any classroom yet.</strong>
                {% endfor %}
              </div>
              <div class="profile-reviews tab">
                <h1>Update Profile</h1>
                <form method="POST" onsubmit="return validateprofile();" enctype="multipart/form-data">
					{% csrf_token %}
					<p id="profile-errors"></p>
					<div id="profile-edit">
						{% for field in p_form %}
							{% if field.field.widget.input_type == 'file' %}
							<input type="file" name="file" id="actual-btn" hidden/>
							<label id="file-upload-label" class="text-center"for="actual-btn">                       
								{% if user.profile.profile_pic %}
									{% if not accounts %}
										{{ user.profile.profile_pic|filebasename }}.
									{% endif %}
								 	Click to change
								{% endif %}
								Upload Profile pic<i class="fa mx-2 fa-upload" aria-hidden="true"></i></label>
							{% else %}
								{{ field.label_tag }}<br>
								{{ field }}
							{% endif %}
						{% endfor %}<br>
						<input type="submit" class="btn btn-primary float-right"value="Update Profile">
					</div>
				</form>
              </div>
              <div class="profile-settings tab">
                <div class="account-setting">
                  <h1>Acount Setting</h1>
                  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Reprehenderit omnis eaque, expedita nostrum, facere libero provident laudantium. Quis, hic doloribus! Laboriosam nemo tempora praesentium. Culpa quo velit omnis, debitis maxime, sequi
                    animi dolores commodi odio placeat, magnam, cupiditate facilis impedit veniam? Soluta aliquam excepturi illum natus adipisci ipsum quo, voluptatem, nemo, commodi, molestiae doloribus magni et. Cum, saepe enim quam voluptatum vel debitis
                    nihil, recusandae, omnis officiis tenetur, ullam rerum.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
{% endblock %}
{% block javascript %}
<script>
$(".nav ul li").click(function() {
  $(this)
    .addClass("active")
    .siblings()
    .removeClass("active");
});

const tabBtn = document.querySelectorAll(".nav ul li");
const tab = document.querySelectorAll(".tab");

function tabs(panelIndex) {
  tab.forEach(function(node) {
    node.style.display = "none";
  });
  tab[panelIndex].style.display = "block";
}
tabs(0);

let bio = document.querySelector(".bio");
const bioMore = document.querySelector("#see-more-bio");
const bioLength = bio.innerText.length;

function bioText() {
  bio.oldText = bio.innerText;

  bio.innerText = bio.innerText.substring(0, 100) + "...";
  bio.innerHTML += `<span onclick='addLength()' id='see-more-bio'>See More</span>`;
}
//        console.log(bio.innerText)

bioText();

function addLength() {
  bio.innerText = bio.oldText;
  bio.innerHTML +=
    "&nbsp;" + `<span onclick='bioText()' id='see-less-bio'>See Less</span>`;
  document.getElementById("see-less-bio").addEventListener("click", () => {
    document.getElementById("see-less-bio").style.display = "none";
  });
}
if (document.querySelector(".alert-message").innerText > 9) {
  document.querySelector(".alert-message").style.fontSize = ".7rem";
}

</script>
{% endblock %}
